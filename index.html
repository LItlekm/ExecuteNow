<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Cloudflare Worker 代理地址（部署后填写，例如：https://xxxx.yyy.workers.dev） -->
    <meta name="ai-proxy-url" content="https://1323301681-65hr8ej21f.ap-guangzhou.tencentscf.com">
    <title data-i18n="app_title">任务拆解助手</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 主界面 -->
    <div class="app-container" id="mainView">
        <header class="header">
            <h1 class="title" data-i18n="app_title">任务拆解助手</h1>
            <div class="header-actions">
                <button id="achievementsBtn" class="btn btn-icon" title="成就">
                    <span>🏆</span>
                </button>
                <button id="settingsBtn" class="btn btn-icon" title="设置">
                    <span>⚙️</span>
                </button>
                <button id="themeToggle" class="btn btn-icon" title="切换主题">
                    <span class="theme-icon">🌙</span>
                </button>
            </div>
        </header>

        <main class="main-content">
            <!-- 连续天数显示区 -->
            <section class="streak-display" id="streakDisplay">
                <div class="streak-display-content">
                    <div class="streak-main">
                        <div class="streak-flame-wrapper">
                            <span class="streak-flame" id="streakFlame">🔥</span>
                        </div>
                        <div class="streak-info">
                            <div class="streak-number"><span id="currentStreak">0</span> <span data-i18n="days">天</span></div>
                            <div class="streak-label" data-i18n="streak_days">连续使用</div>
                            <div class="freeze-streak-tokens" id="freezeTokens"></div>
                        </div>
                    </div>
                    <div class="streak-stats">
                        <div class="streak-stat">
                            <div class="streak-stat-value" id="todayTasks">0</div>
                            <div class="streak-stat-label" data-i18n="today_completed">今日完成</div>
                        </div>
                        <div class="streak-stat">
                            <div class="streak-stat-value"><span data-i18n="longest_record">最高</span> <span id="longestStreak">0</span></div>
                            <div class="streak-stat-label" data-i18n="days">天</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 快速操作 -->
            <section class="quick-actions">
                <button id="createTaskBtn" class="action-card action-card-primary">
                    <span class="action-icon">✨</span>
                    <span class="action-text" data-i18n="create_new_task">创建新任务</span>
                </button>
                <button id="useTemplateBtn" class="action-card action-card-secondary">
                    <span class="action-icon">📋</span>
                    <span class="action-text" data-i18n="use_template">使用模板</span>
                </button>
            </section>

            <!-- 挑战系统 -->
            <section class="challenges-section" id="challengesSection">
                <div class="challenges-header">
                    <h2 class="challenges-title" data-i18n="challenges_title">今日挑战</h2>
                    <button class="create-challenge-btn" id="createChallengeBtn">
                        <span>+</span>
                        <span data-i18n="create_challenge">创建挑战</span>
                    </button>
                </div>
                <div class="challenges-list" id="challengesList">
                    <div class="challenge-empty" id="challengesEmpty">
                        <span class="challenge-empty-icon">🎯</span>
                        <p class="challenge-empty-text" data-i18n="no_challenges">还没有挑战</p>
                        <p class="challenge-empty-hint" data-i18n="no_challenges_hint">创建一个挑战，养成好习惯</p>
                        <button class="btn btn-primary" style="margin-top: 8px;" onclick="document.getElementById('createChallengeBtn').click()">
                            + <span data-i18n="create_challenge">创建挑战</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- 任务列表 -->
            <section class="task-list-section">
                <div class="section-header">
                    <h2 class="section-title">我的任务</h2>
                    <span class="task-count" id="taskCount">0 个任务</span>
                </div>
                <div class="task-list" id="taskList">
                    <div class="empty-state" id="emptyState">
                        <span class="empty-icon">🎯</span>
                        <p class="empty-text">还没有任务</p>
                        <p class="empty-hint">创建一个任务，把它拆解成小步骤</p>
                    </div>
                </div>
            </section>
        </main>

        <footer class="footer">
            <p class="footer-text">杀死拖延症的是极致的具体</p>
        </footer>
    </div>

    <!-- 专注模式界面 -->
    <div class="focus-mode" id="focusMode">
        <header class="focus-header">
            <div class="focus-task-name" id="focusTaskName">任务名称</div>
            <button id="exitFocusBtn" class="btn btn-ghost">退出</button>
        </header>

        <main class="focus-main">
            <!-- 进度 -->
            <div class="focus-progress">
                <span class="progress-text">第 <span id="currentStepNum">1</span> 步 / 共 <span id="totalStepNum">5</span> 步</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <!-- 步骤计时器 -->
            <div class="step-timer-wrapper">
                <div class="step-timer" id="stepTimerContainer">
                    <span class="timer-icon">⏱️</span>
                    <span class="timer-value" id="stepTimerDisplay">00:00</span>
                </div>
                <button id="pauseTimerBtn" class="btn btn-timer-control" title="暂停">
                    <span class="pause-icon">⏸️</span>
                </button>
            </div>

            <!-- 当前步骤 -->
            <div class="focus-step-container">
                <div class="focus-step-card" id="focusStepCard">
                    <div class="step-content" id="stepContent">
                        当前步骤内容
                    </div>
                    <div class="step-time-spent" id="stepTimeSpent"></div>
                </div>
            </div>

            <!-- 便签区域 -->
            <div class="step-notes-area" id="stepNotesArea">
                <div class="notes-header">
                    <button class="add-note-btn" id="addNoteBtn">
                        <span class="note-icon">📝</span>
                        <span class="note-text" data-i18n="add_note">添加便签</span>
                    </button>
                    <div class="notes-indicator" id="notesIndicator" style="display: none;">
                        <span class="notes-count" id="notesCount">0</span>
                        <span data-i18n="notes_suffix">条便签</span>
                    </div>
                </div>
                <div class="notes-preview" id="notesPreview"></div>
            </div>

            <!-- 教练话语 -->
            <div class="coach-message">
                <span class="coach-avatar" id="coachAvatar">👩</span>
                <p class="coach-text" id="coachMessage">准备好了吗？我们开始吧~</p>
            </div>

            <!-- 操作按钮 -->
            <div class="focus-actions">
                <button id="completeStepBtn" class="btn btn-complete">
                    <span class="btn-text">完成这一步</span>
                </button>
                <div class="celebration-container" id="celebrationContainer"></div>
            </div>

            <div class="focus-secondary-actions">
                <button id="skipStepBtn" class="btn btn-ghost">跳过</button>
                <button id="shelveTaskBtn" class="btn btn-ghost">搁置任务</button>
            </div>
        </main>

        <!-- 完成动画覆盖层 -->
        <div class="completion-overlay" id="completionOverlay">
            <div class="completion-content">
                <span class="completion-icon">🎉</span>
                <p class="completion-text">太棒了！任务完成！</p>
                <div class="completion-stats" id="completionStats">
                    <div class="stat-item">
                        <span class="stat-label">总用时</span>
                        <span class="stat-value" id="totalTimeDisplay">00:00:00</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">完成步骤</span>
                        <span class="stat-value" id="completedStepsDisplay">0/0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 步骤完成庆祝动画 -->
        <div class="step-celebration-overlay" id="stepCelebrationOverlay">
            <div class="step-celebration-content">
                <svg class="checkmark-circle" viewBox="0 0 80 80">
                    <circle class="check-circle-path" cx="40" cy="40" r="36" fill="none"/>
                    <path class="check-path" d="M24 40L34 50L56 28" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
        </div>
    </div>

    <!-- 创建任务弹窗 -->
    <div class="modal-overlay" id="createTaskModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3 class="modal-title">创建新任务</h3>
                <button class="modal-close" id="closeCreateModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">任务名称</label>
                    <input type="text" id="taskNameInput" class="form-input" placeholder="例如：写周报" maxlength="50">
                </div>

                <!-- 步骤生成器 -->
                <div class="form-group step-generator">
                    <label class="form-label">步骤生成</label>
                    <div class="step-generator-row">
                        <div class="step-type-selector">
                            <button class="step-type-btn active" data-type="simple">
                                <span class="step-type-icon">📋</span>
                                <span class="step-type-name">简约</span>
                                <span class="step-type-desc">3-5个核心步骤</span>
                            </button>
                            <button class="step-type-btn" data-type="detailed">
                                <span class="step-type-icon">📝</span>
                                <span class="step-type-name">具体</span>
                                <span class="step-type-desc">5-8个详细步骤</span>
                            </button>
                            <button class="step-type-btn" data-type="custom">
                                <span class="step-type-icon">⚙️</span>
                                <span class="step-type-name">自定义</span>
                                <span class="step-type-desc">3-10个可选步骤</span>
                            </button>
                        </div>
                        <button id="generateStepsBtn" class="btn btn-secondary" disabled>
                            <span class="generate-icon">✨</span>
                            生成步骤
                        </button>
                    </div>
                    <div class="custom-step-count" id="customStepCount" style="display: none;">
                        <label class="form-label-small">步骤数量：<span id="customStepCountValue">5</span></label>
                        <input type="range" id="customStepCountInput" min="3" max="10" value="5">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">选择教练</label>
                    <div class="coach-selector" id="coachSelector">
                        <!-- 教练选项将动态生成 -->
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">添加步骤</label>
                    <div class="step-input-row">
                        <input type="text" id="stepInput" class="form-input" placeholder="输入一个具体的小步骤" maxlength="100">
                        <button id="addStepBtn" class="btn btn-primary">添加</button>
                    </div>
                    <p class="form-hint">提示：步骤越具体越好，比如"打开电脑"而不是"开始工作"</p>
                </div>

                <div class="steps-preview" id="stepsPreview">
                    <div class="steps-list" id="stepsList">
                        <!-- 步骤列表将动态生成 -->
                    </div>
                    <p class="steps-empty" id="stepsEmpty">还没有添加步骤</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelCreateTask">取消</button>
                <button class="btn btn-primary" id="confirmCreateTask" disabled>创建任务</button>
            </div>
        </div>
    </div>

    <!-- 选择模板弹窗 -->
    <div class="modal-overlay" id="templateModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <div class="template-tabs">
                    <button class="tab-btn active" data-tab="preset" data-i18n="preset_templates">预设模板</button>
                    <button class="tab-btn" data-tab="custom" data-i18n="my_templates">我的模板</button>
                </div>
                <button class="modal-close" id="closeTemplateModal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 预设模板标签页 -->
                <div class="tab-content active" id="presetTab">
                    <div class="template-categories" id="templateCategories">
                        <!-- 分类标签将动态生成 -->
                    </div>
                    <div class="template-grid" id="templateGrid">
                        <!-- 模板卡片将动态生成 -->
                    </div>
                </div>

                <!-- 自定义模板标签页 -->
                <div class="tab-content" id="customTab">
                    <div class="custom-header">
                        <button id="createCustomBtn" class="btn btn-primary">
                            <span aria-hidden="true">+</span>
                            <span data-i18n="create_custom">创建模板</span>
                        </button>
                        <button id="importBtn" class="btn btn-secondary">
                            <span aria-hidden="true">📥</span>
                            <span data-i18n="import_template">导入</span>
                        </button>
                    </div>
                    <div class="template-grid" id="customGrid">
                        <!-- 自定义模板卡片将动态生成 -->
                    </div>
                    <div class="empty-state" id="customEmpty" style="display:none;">
                        <span class="empty-icon">📝</span>
                        <p class="empty-text" data-i18n="no_custom_templates">还没有自定义模板</p>
                        <p class="empty-hint" data-i18n="no_custom_hint">创建你自己的专属模板</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 模板预览弹窗 -->
    <div class="modal-overlay" id="templatePreviewModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="previewTemplateName">模板名称</h3>
                <button class="modal-close" id="closePreviewModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">选择教练</label>
                    <div class="coach-selector" id="previewCoachSelector">
                        <!-- 教练选项将动态生成 -->
                    </div>
                </div>
                <div class="preview-steps" id="previewSteps">
                    <!-- 步骤预览将动态生成 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelUseTemplate">取消</button>
                <button class="btn btn-primary" id="confirmUseTemplate">使用此模板</button>
            </div>
        </div>
    </div>

    <!-- 搁置任务弹窗 -->
    <div class="modal-overlay" id="shelveModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3 class="modal-title">搁置任务</h3>
                <button class="modal-close" id="closeShelveModal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-description">暂时放下这个任务，之后可以继续</p>
                <textarea id="shelveReasonInput" class="form-textarea" placeholder="记录一下搁置原因（可选）" maxlength="200"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelShelve">取消</button>
                <button class="btn btn-warning" id="confirmShelve">确认搁置</button>
            </div>
        </div>
    </div>

    <!-- 设置面板 -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">设置</h3>
                <button class="modal-close" id="closeSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-item">
                    <div class="setting-info">
                        <span class="setting-label">默认教练</span>
                        <span class="setting-description">创建任务时的默认教练</span>
                    </div>
                    <select id="defaultCoachSelect" class="form-select">
                        <!-- 选项将动态生成 -->
                    </select>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <span class="setting-label" data-i18n="vibration">完成震动反馈</span>
                        <span class="setting-description" data-i18n="vibration_hint">完成步骤时震动提示</span>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="vibrationToggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <span class="setting-label">AI服务提供商</span>
                        <span class="setting-description">选择用于生成步骤的AI服务</span>
                    </div>
                    <select id="aiProviderSelect" class="form-select">
                        <option value="deepseek" selected>Deepseek (deepseek-chat)</option>
                        <option value="zhipu">智谱GLM (glm-4.5-air)</option>
                    </select>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <span class="setting-label">AI API Key</span>
                        <span class="setting-description">用于AI生成步骤功能（已配置代理服务，无需填写）</span>
                    </div>
                    <input type="password" id="aiApiKeyInput" class="form-input" placeholder="输入你的API Key">
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <span class="setting-label" data-i18n="language">语言</span>
                        <span class="setting-description" data-i18n="language_hint">选择界面语言</span>
                    </div>
                    <div class="language-selector" id="languageSelector">
                        <label class="lang-option">
                            <input type="radio" name="language" value="zh" checked>
                            <span data-i18n="language_zh">中文</span>
                        </label>
                        <label class="lang-option">
                            <input type="radio" name="language" value="en">
                            <span data-i18n="language_en">English</span>
                        </label>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <span class="setting-label" data-i18n="clear_data">清除所有数据</span>
                        <span class="setting-description" data-i18n="clear_data_hint">删除所有任务和设置</span>
                    </div>
                    <button id="clearDataBtn" class="btn btn-danger btn-sm" data-i18n="confirm_clear">清除</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 确认删除弹窗 -->
    <div class="modal-overlay" id="deleteConfirmModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3 class="modal-title">确认删除</h3>
                <button class="modal-close" id="closeDeleteModal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-description">确定要删除这个任务吗？此操作无法撤销。</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDelete">取消</button>
                <button class="btn btn-danger" id="confirmDelete">删除</button>
            </div>
        </div>
    </div>

    <!-- 自定义模板编辑器弹窗 -->
    <div class="modal-overlay" id="customEditorModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3 class="modal-title" id="editorTitle">创建模板</h3>
                <button class="modal-close" id="closeEditorModal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 基础信息 -->
                <div class="form-group">
                    <label class="form-label">模板名称</label>
                    <input type="text" id="editorName" class="form-input" placeholder="例如：晨间流程" maxlength="20">
                </div>

                <!-- 图标选择 -->
                <div class="form-group">
                    <label class="form-label">选择图标</label>
                    <div class="icon-selector" id="iconSelector">
                        <!-- 图标按钮将动态生成 -->
                    </div>
                </div>

                <!-- 分类 -->
                <div class="form-group">
                    <label class="form-label">分类</label>
                    <select id="editorCategory" class="form-select">
                        <option value="日常">日常</option>
                        <option value="工作">工作</option>
                        <option value="学习">学习</option>
                        <option value="健康">健康</option>
                    </select>
                </div>

                <!-- 颜色（可选） -->
                <div class="form-group">
                    <label class="form-label">主题色（可选）</label>
                    <div class="color-selector" id="colorSelector">
                        <!-- 颜色按钮将动态生成 -->
                    </div>
                </div>

                <!-- 标签（可选） -->
                <div class="form-group">
                    <label class="form-label">标签（可选）</label>
                    <div class="tags-wrapper">
                        <div id="tagsDisplay"></div>
                        <input type="text" id="tagInput" class="form-input" placeholder="按回车添加标签">
                    </div>
                </div>

                <!-- 描述（可选） -->
                <div class="form-group">
                    <label class="form-label">描述（可选）</label>
                    <textarea id="editorDesc" class="form-textarea" placeholder="简单描述这个模板的用途" maxlength="100"></textarea>
                </div>

                <!-- 步骤 -->
                <div class="form-group">
                    <label class="form-label">步骤</label>
                    <div class="step-input-row">
                        <input type="text" id="editorStepInput" class="form-input" placeholder="添加步骤">
                        <button id="addEditorStep" class="btn btn-primary">添加</button>
                    </div>
                    <div class="steps-list" id="editorStepsList">
                        <!-- 步骤列表将动态生成 -->
                    </div>
                    <p class="steps-empty" id="editorStepsEmpty">还没有添加步骤</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditor">取消</button>
                <button class="btn btn-primary" id="saveEditor" disabled>保存模板</button>
            </div>
        </div>
    </div>

    <!-- 创建挑战弹窗 -->
    <div class="modal-overlay" id="createChallengeModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3 class="modal-title">创建挑战</h3>
                <button class="modal-close" id="closeCreateChallengeModal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 挑战类型选择 -->
                <div class="form-group">
                    <label class="form-label">挑战类型</label>
                    <div class="challenge-type-selector" id="challengeTypeSelector">
                        <button class="challenge-type-btn active" data-type="daily">每日挑战</button>
                        <button class="challenge-type-btn" data-type="weekly">每周挑战</button>
                        <button class="challenge-type-btn" data-type="custom">自定义</button>
                    </div>
                </div>

                <!-- 快捷模板 -->
                <div class="form-group" id="challengeTemplateGroup">
                    <label class="form-label">快捷模板</label>
                    <div class="challenge-template-grid" id="challengeTemplateGrid">
                        <!-- 模板将动态生成 -->
                    </div>
                </div>

                <!-- 自定义挑战配置 -->
                <div class="form-group">
                    <label class="form-label">挑战名称</label>
                    <input type="text" id="challengeNameInput" class="form-input" placeholder="例如：每日学习30分钟" maxlength="30">
                </div>

                <div class="form-group">
                    <label class="form-label">目标数值</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="number" id="challengeTargetInput" class="form-input" placeholder="30" min="1" style="flex: 1;">
                        <select id="challengeTypeUnitSelect" class="form-select" style="width: 110px;"></select>
                        <select id="challengeUnitSelect" class="form-select" style="width: 110px;">
                            <option value="minutes">分钟</option>
                            <option value="tasks">任务</option>
                            <option value="steps">步骤</option>
                            <option value="times">次数</option>
                            <option value="checkin">打卡</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">分类</label>
                    <select id="challengeCategorySelect" class="form-select">
                        <option value="日常">日常</option>
                        <option value="学习">学习</option>
                        <option value="工作">工作</option>
                        <option value="健康">健康</option>
                        <option value="运动">运动</option>
                    </select>
                </div>

                <!-- 任务关联配置（仅tasks/steps单位显示） -->
                <div class="form-group" id="taskMatchGroup" style="display: none;">
                    <label class="form-label" data-i18n="challenge_task_match">任务关联</label>

                    <!-- 关联模式选择 -->
                    <div class="match-mode-selector" id="matchModeSelector">
                        <label class="match-mode-option active" data-mode="all">
                            <input type="radio" name="matchMode" value="all" checked>
                            <div class="match-mode-content">
                                <span class="match-mode-title" data-i18n="challenge_match_all">全部任务</span>
                                <span class="match-mode-desc" data-i18n="challenge_match_all_desc">所有任务都计入此挑战</span>
                            </div>
                        </label>
                        <label class="match-mode-option" data-mode="category">
                            <input type="radio" name="matchMode" value="category">
                            <div class="match-mode-content">
                                <span class="match-mode-title" data-i18n="challenge_match_category">按分类</span>
                                <span class="match-mode-desc" data-i18n="challenge_match_category_desc">只有指定分类的任务计入</span>
                            </div>
                        </label>
                        <label class="match-mode-option" data-mode="specific">
                            <input type="radio" name="matchMode" value="specific">
                            <div class="match-mode-content">
                                <span class="match-mode-title" data-i18n="challenge_match_specific">指定模板</span>
                                <span class="match-mode-desc" data-i18n="challenge_match_specific_desc">只有选中的模板任务计入</span>
                            </div>
                        </label>
                    </div>

                    <!-- 分类选择器（category模式显示） -->
                    <div class="match-categories-panel" id="matchCategoriesPanel" style="display: none;">
                        <label class="form-label-small" data-i18n="select_categories">选择分类（可多选）</label>
                        <div class="category-checkbox-grid" id="matchCategoryGrid">
                            <!-- 动态生成分类复选框 -->
                        </div>
                    </div>

                    <!-- 模板选择器（specific模式显示） -->
                    <div class="match-templates-panel" id="matchTemplatesPanel" style="display: none;">
                        <label class="form-label-small" data-i18n="select_templates">选择模板</label>
                        <div class="template-checkbox-list" id="matchTemplateList">
                            <!-- 动态生成模板列表 -->
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">选择图标</label>
                    <div class="challenge-icon-grid" id="challengeIconGrid">
                        <!-- 图标将动态生成 -->
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">主题色</label>
                    <div class="challenge-color-grid" id="challengeColorGrid">
                        <!-- 颜色将动态生成 -->
                    </div>
                </div>

                <!-- 自定义周期设置 -->
                <div class="form-group" id="customPeriodGroup" style="display: none;">
                    <label class="form-label">重置周期（天）</label>
                    <input type="number" id="challengePeriodInput" class="form-input" placeholder="例如：3" min="2" max="30">
                    <p class="form-hint">设置每N天重置一次挑战进度</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelCreateChallenge">取消</button>
                <button class="btn btn-primary" id="confirmCreateChallenge">创建挑战</button>
            </div>
        </div>
    </div>

    <!-- 连续记录日历弹窗 -->
    <div class="modal-overlay" id="calendarModal">
        <div class="modal calendar-modal">
            <div class="modal-header">
                <h3 class="modal-title">连续记录</h3>
                <button class="modal-close" id="closeCalendarModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="calendar-header">
                    <button class="calendar-nav-btn" id="calendarPrevBtn">‹</button>
                    <span class="calendar-month" id="calendarMonthTitle">2026年1月</span>
                    <button class="calendar-nav-btn" id="calendarNextBtn">›</button>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-day-label">日</div>
                    <div class="calendar-day-label">一</div>
                    <div class="calendar-day-label">二</div>
                    <div class="calendar-day-label">三</div>
                    <div class="calendar-day-label">四</div>
                    <div class="calendar-day-label">五</div>
                    <div class="calendar-day-label">六</div>
                </div>
                <div class="calendar-grid" id="calendarDaysGrid">
                    <!-- 日期将动态生成 -->
                </div>
                <div class="calendar-legend">
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-dot" style="background: #d1fae5;"></div>
                        <span>低活跃</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-dot" style="background: #34d399;"></div>
                        <span>中活跃</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-dot" style="background: var(--gradient-success);"></div>
                        <span>高活跃</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 成就解锁通知 -->
    <div class="achievement-notification" id="achievementNotification">
        <span class="achievement-icon" id="achievementIcon">🏆</span>
        <div class="achievement-info">
            <h4>成就解锁！</h4>
            <h3 id="achievementName">成就名称</h3>
        </div>
    </div>

    <!-- 成就展示弹窗 -->
    <div class="modal-overlay" id="achievementsModal">
        <div class="modal modal-large achievements-modal">
            <div class="modal-header">
                <h3 class="modal-title" data-i18n="achievements_title">我的成就</h3>
                <button class="modal-close" id="closeAchievementsModal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 成就统计概览 -->
                <div class="achievements-overview">
                    <div class="achievements-stat">
                        <span class="stat-icon">🏆</span>
                        <div class="stat-content">
                            <span class="stat-value" id="unlockedCount">0</span>
                            <span class="stat-label" data-i18n="achievements_unlocked">已解锁</span>
                        </div>
                    </div>
                    <div class="achievements-stat">
                        <span class="stat-icon">📊</span>
                        <div class="stat-content">
                            <span class="stat-value" id="achievementsProgress">0%</span>
                            <span class="stat-label" data-i18n="achievements_progress">完成度</span>
                        </div>
                    </div>
                    <div class="achievements-stat">
                        <span class="stat-icon">💎</span>
                        <div class="stat-content">
                            <span class="stat-value" id="rarestAchievement">-</span>
                            <span class="stat-label" data-i18n="rarest_achievement">最稀有</span>
                        </div>
                    </div>
                </div>

                <!-- 成就筛选器 -->
                <div class="achievements-filters">
                    <div class="filter-group">
                        <label data-i18n="filter_by">筛选：</label>
                        <div class="filter-tabs" id="achievementsFilterTabs">
                            <button class="filter-tab active" data-filter="all" data-i18n="filter_all">全部</button>
                            <button class="filter-tab" data-filter="unlocked" data-i18n="filter_unlocked">已解锁</button>
                            <button class="filter-tab" data-filter="locked" data-i18n="filter_locked">未解锁</button>
                        </div>
                    </div>
                    <div class="filter-group">
                        <label data-i18n="sort_by">排序：</label>
                        <select class="form-select filter-select" id="achievementsSortSelect">
                            <option value="category" data-i18n="sort_category">按类别</option>
                            <option value="rarity" data-i18n="sort_rarity">按稀有度</option>
                            <option value="time" data-i18n="sort_time">按解锁时间</option>
                        </select>
                    </div>
                </div>

                <!-- 成就列表 -->
                <div class="achievements-list" id="achievementsList">
                    <!-- 成就卡片将动态生成 -->
                </div>

                <!-- 空状态 -->
                <div class="achievements-empty" id="achievementsEmpty" style="display: none;">
                    <span class="empty-icon">🔒</span>
                    <p class="empty-text" data-i18n="no_achievements">还没有解锁任何成就</p>
                    <p class="empty-hint" data-i18n="no_achievements_hint">继续使用应用来解锁成就吧！</p>
                </div>
            </div>
        </div>
    </div>

    <!-- AI 生成步骤动效弹窗 -->
    <div class="modal-overlay" id="aiGeneratingModal">
        <div class="modal ai-generating-modal">
            <!-- 阶段1: AI思考动画区域 -->
            <div class="ai-thinking-stage" id="aiThinkingStage">
                <div class="ai-avatar">
                    <span class="ai-icon" id="thinkingCoachAvatar">👩</span>
                    <div class="ai-pulse-ring"></div>
                    <div class="ai-pulse-ring ai-pulse-ring-delay"></div>
                </div>
                <div class="ai-thinking-text">
                    <span class="thinking-label" id="thinkingLabel">正在努力思考如何拆解</span>
                    <span class="task-name-highlight" id="thinkingTaskName">「任务名称」</span>
                </div>
                <div class="thinking-dots" aria-hidden="true">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                </div>
            </div>

            <!-- 阶段2: 步骤逐步生成区域 -->
            <div class="ai-steps-stage" id="aiStepsStage">
                <div class="steps-header">
                    <span class="steps-title">已生成步骤</span>
                    <span class="steps-count"><span id="generatedStepsCount">0</span>/<span id="totalStepsCount">5</span></span>
                </div>
                <div class="steps-container" id="stepsContainer">
                    <!-- 步骤将逐步添加到这里 -->
                </div>
            </div>

            <!-- 阶段3: 完成状态区域 -->
            <div class="ai-complete-stage" id="aiCompleteStage">
                <div class="complete-icon">✨</div>
                <div class="complete-text">步骤生成完成！</div>
                <div class="complete-hint">可以开始执行任务了</div>
            </div>
        </div>
    </div>

    <!-- 便签编辑弹窗 -->
    <div class="modal-overlay" id="noteModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3 class="modal-title" data-i18n="note_title">便签</h3>
                <button class="modal-close" id="closeNoteModal">&times;</button>
            </div>
            <div class="modal-body">
                <textarea id="noteContentInput" class="form-textarea note-textarea"
                          placeholder="记录你的想法..."
                          maxlength="500"
                          data-i18n-placeholder="note_placeholder"></textarea>
                <div class="note-meta" id="noteEditMeta" style="display: none;">
                    <span class="note-time" id="noteEditTime"></span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger btn-sm" id="deleteNoteBtn" style="display: none;">
                    <span data-i18n="delete">删除</span>
                </button>
                <div style="flex: 1;"></div>
                <button class="btn btn-secondary" id="cancelNoteBtn" data-i18n="cancel">取消</button>
                <button class="btn btn-primary" id="saveNoteBtn" data-i18n="save">保存</button>
            </div>
        </div>
    </div>

    <!-- 便签列表弹窗 -->
    <div class="modal-overlay" id="notesListModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" data-i18n="notes_list_title">步骤便签</h3>
                <button class="modal-close" id="closeNotesListModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="notes-list" id="notesList"></div>
                <div class="notes-empty" id="notesEmpty" style="display: none;">
                    <span class="empty-icon">📝</span>
                    <p data-i18n="no_notes">还没有便签</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="addNewNoteBtn">
                    <span>+</span>
                    <span data-i18n="add_note">添加便签</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 隐藏的文件输入 -->
    <input type="file" id="importFileInput" accept=".json" style="display:none">

    <script src="templates.js"></script>
    <script src="customTemplates.js"></script>
    <script src="achievements.js"></script>
    <script src="usageStatsManager.js"></script>
    <script src="challengeManager.js"></script>
    <script src="i18n.js"></script>
    <script src="app.js"></script>
</body>
</html>
